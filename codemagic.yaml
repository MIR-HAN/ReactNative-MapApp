workflows:
  react-native-ios-workflow:
    name: React Native iOS Build
    max_build_duration: 120
    instance_type: mac_mini_m2
    environment:
      vars:
        GOOGLE_MAPS_API_KEY: Encrypted
      node: 20.19.5

    scripts:

      - name: Install Ruby 3.2 and CocoaPods
        script: |
          brew install ruby
          echo 'export PATH="/usr/local/opt/ruby/bin:$PATH"' >> ~/.bash_profile
          source ~/.bash_profile
          gem install cocoapods -v 1.14.3

      - name: Install dependencies
        script: |
          npm install --legacy-peer-deps
          cd ios
          pod repo update
          pod cache clean --all
          pod install --clean-install

      - name: iOS build
        script: |
          cd ios
          xcodebuild -workspace MapApp.xcworkspace -scheme MapApp -sdk iphoneos -configuration Release
